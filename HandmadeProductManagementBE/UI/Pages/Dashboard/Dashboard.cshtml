@page
@model UI.Pages.Dashboard.DashboardModel
@{
    ViewData["Title"] = "Dashboard";
}
@using UI.Pages.Shared
@{
    var errorModel = new ErrorMessageModel
            {
                ErrorMessage = Model.ErrorMessage,
                ErrorDetail = Model.ErrorDetail
            };
    var token = HttpContext.Session.GetString("Token");
}
@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <partial name="_ErrorMessage" model="errorModel" />
}
<div class="dashboard container mx-auto p-6">
    <h1 class="mb-8 text-3xl font-bold text-gray-800">Dashboard</h1>

    <div class="grid-cols-1 grid gap-6 md:grid-cols-2">
        <div class="dashboard-section rounded-lg bg-white p-6 shadow-md">
            <h2 class="mb-4 text-xl font-semibold text-gray-700">Total Sale</h2>
            <p class="text-lg text-gray-600">Total Sales: <span class="font-bold text-blue-500">@Model.TotalSales</span></p>
        </div>

        <div class="dashboard-section rounded-lg bg-white p-6 shadow-md">
            <h2 class="mb-4 text-xl font-semibold text-gray-700">Sales Trend Over Time</h2>
            <div class="relative h-64">
                <canvas id="salesTrendChart" class="h-full w-full"></canvas>
            </div>
        </div>

        <div class="dashboard-section rounded-lg bg-white p-6 shadow-md">
            <h2 class="mb-4 text-xl font-semibold text-gray-700">Top 10 Most-Sale Shops</h2>
            <ul class="ml-6 list-disc text-gray-600">
                @foreach (var shop in Model.TopShops)
                {
                    <li class="py-1">
                        <a href="/Shop/Index?id=@shop.Id" class="font-bold text-blue-500 hover:underline">@shop.Name</a>: @shop.TotalSales
                    </li>
                }
            </ul>
        </div>

        <div class="dashboard-section rounded-lg bg-white p-6 shadow-md">
            <h2 class="mb-4 text-xl font-semibold text-gray-700">Type Distribution</h2>
            <div class="relative h-64">
                <canvas id="typeDistributionChart" class="h-full w-full"></canvas>
            </div>
        </div>
    </div>
</div>

@section Scripts {
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            // Sales Trend Chart
            var salesTrendCtx = document.getElementById('salesTrendChart').getContext('2d');
            var salesTrendChart = new Chart(salesTrendCtx, {
                type: 'line',
                data: {
                    labels: @Html.Raw(Json.Serialize(Model.SalesTrendDates)),
                    datasets: [{
                        label: 'Sales',
                        data: @Html.Raw(Json.Serialize(Model.SalesTrendData)),
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            });

            // Type Distribution Chart
            var typeDistributionCtx = document.getElementById('typeDistributionChart').getContext('2d');
            var typeDistributionChart = new Chart(typeDistributionCtx, {
                type: 'pie',
                data: {
                    labels: @Html.Raw(Json.Serialize(Model.TypeDistributionLabels)),
                    datasets: [{
                        data: @Html.Raw(Json.Serialize(Model.TypeDistributionData)),
                        backgroundColor: ['#ff6384', '#36a2eb', '#cc65fe', '#ffce56']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            });
        </script>
}
